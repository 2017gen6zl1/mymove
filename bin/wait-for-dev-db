#!/bin/bash
# This script wait for the local dev Docker database until a timeout is
# reached.

set -eu -o pipefail

db_password="mysecretpassword"
retries=0
timeout=5
db_check_command="psql postgres://postgres:${db_password}@localhost/postgres -c 'select 1;' &> /dev/null"

while ! bash -c "$db_check_command"; do
  retries=$(( retries + 1 ))
  echo "."
  if [[ $retries -eq $timeout ]]; then
    exit 1
  fi
  sleep 1
done
